# https://nixpacks.com/docs/configuration/file

# إعداد المتغيرات البيئية
[variables]
    NPM_CONFIG_UPDATE_NOTIFIER = 'false'
    NPM_CONFIG_FUND = 'false'
    NODE_ENV = 'production'

# إعداد قناة nixpkgs حديثة
[nix]
    # استخدام قناة مستقرة حديثة بدلاً من commit محدد
    channel = "nixpkgs-25.11"

# مرحلة الإعداد الأساسية (تثبيت Node.js)
[phases.setup]
    nixPkgs = ["nodejs_22"]

# مرحلة تثبيت Caddy (بدون nixpkgsArchive قديم)
[phases.caddy]
    dependsOn = ['setup']
    nixPkgs = ['caddy']

# مرحلة تثبيت dependencies
[phases.install]
    dependsOn = ['setup']
    cmds = ['npm ci']

# مرحلة البناء
[phases.build]
    dependsOn = ['install']
    cmds = ['npm run build']

# تهيئة Caddyfile
[phases.fmt]
    dependsOn = ['caddy', 'build']
    cmds = ['caddy fmt --overwrite Caddyfile']

# أمر التشغيل
[start]
cmd = "caddy run --config Caddyfile --adapter caddyfile"

# إضافة وصف
[metadata]
name = "Vite + React + Caddy"
description = "React app built with Vite, served by Caddy"