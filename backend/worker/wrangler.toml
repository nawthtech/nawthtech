name = "nawthtech-api"
main = "src/index.ts"
compatibility_flags = ["nodejs_compat"]
compatibility_date = "2025-12-09"
[observability]
enabled = false
head_sampling_rate = 1
upload_source_maps = true

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1

[observability]
enabled = true

[[observability.destinations]]
type = "traces"
name = "sentry-traces"
endpoint = "https://o4510508331892736.ingest.de.sentry.io/api/4510508452413520/integration/otlp/v1/traces"
headers = { "x-sentry-auth=sentry sentry_key=703dc8c9404510702c2c20ce3aba24d4" }

[[observability.destinations]]
type = "logs"
name = "sentry-logs"
endpoint = "https://o4510508331892736.ingest.de.sentry.io/api/4510508452413520/integration/otlp/v1/logs"
headers = { "x-sentry-auth=sentry sentry_key=703dc8c9404510702c2c20ce3aba24d4" }

# متغيرات البيئة
[vars]
ENVIRONMENT = "production"
APP_NAME = "NawthTech"

# قاعدة بيانات D1 (استخدم ID الحقيقي)
[[d1_databases]]
binding = "DB"
database_name = "nawthtech-db1"
database_id = "bbf15aeb-0718-47c8-9723-d8a83f79e6cb"
workers_url = "db.nawth.workers.dev"
preview_url = "*-db.nawth.workers.dev"
migrations_dir = "migrations"
# بيئات مختلفة
[env.production]
name = "nawthtech-api-production"

[env.staging]
name = "nawthtech-api-staging"

[env.development]
name = "nawthtech-api-dev"

# Sentry-specific configuration for Cloudflare Workers
name = "nawthtech-worker-sentry"
main = "src/index.ts"
compatibility_date = "2025-01-01"

[vars]
SENTRY_DSN = "https://703dc8c9404510702c2c20ce3aba24d4@o4510508331892736.ingest.de.sentry.io/4510508452413520"
SENTRY_ENVIRONMENT = "production"
SENTRY_RELEASE = "nawthtech-worker@${git.commit.short}"
ENABLE_SENTRY = "true"

[build]
command = "npm run build"
upload = { format = "service-worker" }

[build.upload]
include = ["dist/*"]
exclude = ["node_modules", "tests"]

# Sentry source maps configuration
[build.upload.rules]
type = "sentry"
url = "https://sentry.io/api/0/projects/nawthtech/nawthtech-worker/releases/"
token = "${SENTRY_AUTH_TOKEN}"

[otlp]
endpoint = "https://o4510508331892736.ingest.de.sentry.io/api/4510508452413520/integration/otlp/v1/traces"

# Environment-specific settings
[env.production]
vars = { SENTRY_ENVIRONMENT = "production" }

[env.staging]
vars = { SENTRY_ENVIRONMENT = "staging" }

[env.development]
vars = { SENTRY_ENVIRONMENT = "development", SENTRY_DEBUG = "true" }